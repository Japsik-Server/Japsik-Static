---
import Layout from '@/layouts/Layout.astro'
---

<Layout title="Japsikâ„¢ Launcher ë‚´ë ¤ë°›ê¸°">
  <div class="mx-auto max-w-4xl">
    <hr class="my-4" />
    <h1 class="mb-8 text-center text-4xl font-bold">
      Japsikâ„¢ Launcher ë‚´ë ¤ë°›ê¸°
    </h1>
    <hr class="my-4" />
    <div
      class="mt-4 rounded-md border-l-4 border-blue-400 bg-blue-200 p-4 text-blue-600 shadow-md"
      role="alert"
    >
      <p class="font-bold">
        Japsikâ„¢ Launcherì€
        <a
          href="https://japsik.com"
          target="_blank"
          class="text-blue-800 underline">Japsikâ„¢</a
        >ì—ì„œë§Œ ì‚¬ìš©í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br />
        ê³µê°œëœ ìë£Œë¥¼ ë¬´ë‹¨ìœ¼ë¡œ ìˆ˜ì •, ë°°í¬, ë˜ëŠ” ë³µì œí•˜ëŠ” í–‰ìœ„ëŠ” ë¯¼Â·í˜•ì‚¬ìƒì˜ ì±…ì„ì„
        ìˆ˜ë°˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
      </p>
    </div>

    <div class="mb-4 flex space-x-4">
      <!-- Japsik Launcher Latest Version Download Card -->
      <div class="latest flex-1 rounded-md bg-white p-6 shadow-md">
        <h2 class="mb-4 text-xl font-bold">
          ğŸŒ¥ï¸ Japsikâ„¢ Launcher (Stable)
          <span class="float-right text-xs text-gray-500 italic"
            >ì ‘ì† ì‹œ í•„ìˆ˜ ì„¤ì¹˜</span
          >
        </h2>
        <p>
          MinecraftÂ®: Java Edition | Launcher: v<span id="stableLatest"
            >ë¡œë”© ì¤‘...</span
          >
        </p>
        <p class="mb-4">Japsik Launcher (Stable Version)</p>
        <button
          class="block w-full rounded-md bg-blue-500 px-4 py-2 text-center text-white"
          id="stableDownload"
        >
          ë‚´ë ¤ë°›ê¸°
        </button>
      </div>
      <!-- Japsik Launcher Dev Version Download Card -->
      <div class="old flex-1 rounded-md bg-white p-6 shadow-md">
        <h2 class="mb-4 text-xl font-bold">
          ğŸŒ Japsikâ„¢ Launcher (Dev)
          <span class="float-right text-xs text-gray-500 italic"
            >ì ‘ì† ì‹œ í•„ìˆ˜ ì„¤ì¹˜</span
          >
        </h2>
        <p>
          MinecraftÂ®: Java Edition | Launcher: v<span id="devLatest"
            >ë¡œë”© ì¤‘...</span
          >
        </p>
        <p class="mb-4">Japsik Launcher (Dev Version) (ê¶Œì¥í•˜ì§€ ì•ŠìŒ)</p>
        <button
          class="block w-full rounded-md bg-blue-500 px-4 py-2 text-center text-white"
          id="devDownload"
        >
          ë‚´ë ¤ë°›ê¸°
        </button>
      </div>
    </div>
  </div>

  <!-- í‘¸í„° -->
  <footer class="text-center text-sm text-gray-500">
    <hr class="my-4" />
    <!-- ì´ì „ í˜ì´ì§€ë¡œ ëŒì•„ê°€ê¸° ë²„íŠ¼ -->
    <div class="mt-4 text-center">
      <a
        href="/"
        class="inline-block rounded-full border border-gray-500 bg-transparent px-4 py-2 text-gray-500"
        >â† ì´ì „ í˜ì´ì§€ë¡œ ëŒì•„ê°€ê¸°</a
      >
      <hr class="my-2" />
    </div>
    <p>
      â“’ Japsik. ëª¨ë“  ê¶Œë¦¬ ë³´ìœ . Japsikâ„¢ì€ Mojang Studiosì˜ MinecraftÂ®ë¥¼ ê¸°ë°˜ìœ¼ë¡œ
      í•˜ëŠ” ì˜¨ë¼ì¸ ë©€í‹°í”Œë ˆì´ì–´ ê²Œì„ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.<br />MinecraftÂ®ëŠ” Mojang
      Synergies ABì˜ ìƒí‘œì´ë©°, Japsikì€ Mojang Studios í˜¹ì€ Microsoft
      Corporationì™€ ì œíœ´ ê´€ê³„ê°€ ì•„ë‹™ë‹ˆë‹¤.
    </p>
  </footer>

  <script>
    import semver from 'semver'
    import Swal from 'sweetalert2'

    // Github repository info
    const repoOwner = 'Japsik-Server'
    const repoName = 'JapsikLauncher'

    // API endpoint URL
    const apiUrl = `https://api.github.com/repos/${repoOwner}/${repoName}/tags`

    // API í˜¸ì¶œ
    fetch(apiUrl)
      .then(response => {
        if (!response.ok) {
          throw new Error('Network response was not ok')
        }
        return response.json()
      })
      .then(data => {
        const tags = data.map((tag: any) => tag.name)

        const latestStable = getLatestStable(tags).replace('v', '')
        const latestDev = getLatestDev(tags).replace('v', '')

        const stableLatestEl = document.getElementById('stableLatest')
        const devLatestEl = document.getElementById('devLatest')

        if (stableLatestEl) stableLatestEl.textContent = latestStable
        if (devLatestEl) devLatestEl.textContent = latestDev

        const stableDownloadBtn = document.getElementById('stableDownload')
        const devDownloadBtn = document.getElementById('devDownload')

        if (stableDownloadBtn) {
          stableDownloadBtn.onclick = () =>
            showConfirmation(latestStable, 'exe')
        }

        if (devDownloadBtn) {
          devDownloadBtn.onclick = () => showConfirmation(latestDev, 'exe')
        }
      })
      .catch(error => console.error('Error fetching data:', error))

    function getLatestStable(tags: string[]) {
      tags.sort((a, b) => semver.compare(b, a))
      for (const tag of tags) {
        if (!tag.includes('-')) {
          return tag
        }
      }
      return 'N/A'
    }

    function getLatestDev(tags: string[]) {
      let latestDev: string | null = null
      for (const tag of tags) {
        if (tag.includes('-')) {
          if (!latestDev || semver.compare(latestDev, tag) < 0) {
            latestDev = tag
          }
        }
      }
      return latestDev ? latestDev : 'N/A'
    }

    function showConfirmation(version: string, extension: string) {
      Swal.fire({
        title: 'ì†Œí”„íŠ¸ì›¨ì–´ ì‚¬ìš©ê¶Œ ì•ˆë‚´',
        html:
          'JapsikServerâ„¢ LauncherëŠ” <b><a href="https://japsik.xyz" target="_blank">JapsikServerâ„¢</a></b> ë° JapsikServerâ„¢ ì œë°˜ ì„œë¹„ìŠ¤ì—ì„œë§Œ ì‚¬ìš©í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ' +
          'ê³µê°œëœ ìë£Œë¥¼ ë¬´ë‹¨ìœ¼ë¡œ ìˆ˜ì •, ë°°í¬, ë˜ëŠ” ë³µì œí•˜ëŠ” í–‰ìœ„ëŠ” ë¯¼Â·í˜•ì‚¬ìƒì˜ ì±…ì„ì„ ìˆ˜ë°˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br> ' +
          'ë˜í•œ ì´ ì†Œí”„íŠ¸ì›¨ì–´ëŠ” ì–´ë– í•œ ë³´ì¦ì´ ì œê³µë˜ì§€ ì•Šìœ¼ë©°, ì‚¬ìš© ë„ì¤‘ ë°œìƒí•œ ë¬¸ì œì— ëŒ€í•˜ì—¬ JapsikServerì—ì„œëŠ” ì±…ì„ì§€ì§€ ì•ŠìŠµë‹ˆë‹¤. ' +
          'ì´ì— ë™ì˜í•˜ì‹œë‚˜ìš”?',
        icon: 'question',
        showCancelButton: true,
        confirmButtonText: 'ë™ì˜í•˜ê³  ë‚´ë ¤ë°›ê¸°',
        cancelButtonText: 'ì·¨ì†Œ'
      }).then(result => {
        if (result.isConfirmed) {
          const downloadUrl =
            'https://github.com/Japsik-Server/JapsikLauncher/releases/download/' +
            version +
            '/Japsik-Launcher-setup-' +
            version +
            '.' +
            extension
          Swal.fire({
            title: 'ë‹¤ìš´ë¡œë“œê°€ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.',
            html:
              'ë‹¤ìš´ë¡œë“œê°€ ìë™ìœ¼ë¡œ ì‹œì‘ë˜ì§€ ì•ŠëŠ”ë‹¤ë©´ <u><a href="' +
              downloadUrl +
              '">ì´ê³³ì„ ëˆ„ë¥´ì„¸ìš”</a></u>.',
            icon: 'success',
            confirmButtonText: 'í™•ì¸'
          })
          window.location.href = downloadUrl
        }
      })
    }
  </script>
</Layout>
